// Licensed to the .NET Foundation under one or more agreements.
// The .NET Foundation licenses this file to you under the MIT license.
// Modified by the Tsu (https://github.com/GGG-KILLER/Tsu) project for embedding into other projects.
// <auto-generated />

#nullable enable

namespace SimpleCompiler.IR
{
    using System.Collections;
    using System.Collections.Generic;
    using System.Diagnostics.CodeAnalysis;

    public readonly partial struct ChildIrList
    {
        /// <summary>
        /// Enumerates the elements of a <see cref="ChildIrList" />.
        /// </summary>
        public struct Enumerator
        {
            private global::SimpleCompiler.IR.IrNode? _node;
            private int _count;
            private int _childIndex;

            internal Enumerator(global::SimpleCompiler.IR.IrNode? node, int count)
            {
                _node = node;
                _count = count;
                _childIndex = -1;
            }

            // PERF: Initialize an Enumerator directly from a IrNode without going
            // via ChildNodes. This saves constructing an intermediate ChildIrList
            internal void InitializeFrom(global::SimpleCompiler.IR.IrNode node)
            {
                _node = node;
                _count = CountNodes(node.Green);
                _childIndex = -1;
            }

            /// <summary>Advances the enumerator to the next element of the <see cref="ChildIrList" />.</summary>
            /// <returns>true if the enumerator was successfully advanced to the next element; false if the enumerator has passed the end of the collection.</returns>
            [MemberNotNullWhen(true, nameof(_node))]
            public bool MoveNext()
            {
                if (_node != null)
                {
                    var newIndex = _childIndex + 1;
                    if (newIndex < _count)
                    {
                        _childIndex = newIndex;
                        return true;
                    }
                }

                return false;
            }

            /// <summary>Gets the element at the current position of the enumerator.</summary>
            /// <returns>The element in the <see cref="ChildIrList" /> at the current position of the enumerator.</returns>
            public global::SimpleCompiler.IR.IrNode Current
            {
                get
                {
                    if (_node is null)
                        throw new InvalidOperationException("No node to iterate over the children of.");
                    return ItemInternal(_node, _childIndex);
                }
            }

            /// <summary>Sets the enumerator to its initial position, which is before the first element in the collection.</summary>
            public void Reset() => _childIndex = -1;
        }

        private class EnumeratorImpl : IEnumerator<global::SimpleCompiler.IR.IrNode>
        {
            private Enumerator _enumerator;

            internal EnumeratorImpl(global::SimpleCompiler.IR.IrNode? node, int count)
            {
                _enumerator = new Enumerator(node, count);
            }

            /// <summary>
            /// Gets the element in the collection at the current position of the enumerator.
            /// </summary>
            /// <returns>
            /// The element in the collection at the current position of the enumerator.
            ///   </returns>
            public global::SimpleCompiler.IR.IrNode Current => _enumerator.Current;

            /// <summary>
            /// Gets the element in the collection at the current position of the enumerator.
            /// </summary>
            /// <returns>
            /// The element in the collection at the current position of the enumerator.
            ///   </returns>
            object IEnumerator.Current => _enumerator.Current;

            /// <summary>
            /// Advances the enumerator to the next element of the collection.
            /// </summary>
            /// <returns>
            /// true if the enumerator was successfully advanced to the next element; false if the enumerator has passed the end of the collection.
            /// </returns>
            public bool MoveNext() => _enumerator.MoveNext();

            /// <summary>
            /// Sets the enumerator to its initial position, which is before the first element in the collection.
            /// </summary>
            public void Reset() => _enumerator.Reset();

            /// <summary>
            /// Performs application-defined tasks associated with freeing, releasing, or resetting unmanaged resources.
            /// </summary>
            public void Dispose()
            { }
        }
    }
}